{
  "name": "opus-orchestra",
  "displayName": "Claude Agents",
  "description": "Manage multiple Claude Code agents in parallel with git worktrees",
  "version": "0.2.0",
  "publisher": "kyleherndon",
  "engines": {
    "vscode": "^1.85.0"
  },
  "categories": [
    "Other"
  ],
  "activationEvents": [
    "onStartupFinished"
  ],
  "main": "./out/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "claudeAgents.createAgents",
        "title": "Create Agent Worktrees",
        "category": "Claude Agents"
      },
      {
        "command": "claudeAgents.switchToAgent",
        "title": "Switch to Agent",
        "category": "Claude Agents"
      },
      {
        "command": "claudeAgents.showApprovals",
        "title": "Show Approval Queue",
        "category": "Claude Agents"
      },
      {
        "command": "claudeAgents.refreshAgents",
        "title": "Refresh Agent Status",
        "category": "Claude Agents",
        "icon": "$(refresh)"
      },
      {
        "command": "claudeAgents.startAgent",
        "title": "Start Claude in Terminal",
        "category": "Claude Agents",
        "icon": "$(play)"
      },
      {
        "command": "claudeAgents.approveAction",
        "title": "Approve",
        "icon": "$(check)"
      },
      {
        "command": "claudeAgents.rejectAction",
        "title": "Reject",
        "icon": "$(close)"
      },
      {
        "command": "claudeAgents.cleanup",
        "title": "Cleanup Worktrees",
        "category": "Claude Agents"
      },
      {
        "command": "claudeAgents.openDashboard",
        "title": "Open Dashboard",
        "category": "Claude Agents",
        "icon": "$(window)"
      },
      {
        "command": "claudeAgents.initProject",
        "title": "Initialize Project",
        "category": "Claude Agents"
      },
      {
        "command": "claudeAgents.openSettings",
        "title": "Open Settings",
        "category": "Claude Agents",
        "icon": "$(gear)"
      },
      {
        "command": "claudeAgents.createAgentForTask",
        "title": "Create Agent for Task",
        "category": "Claude Agents",
        "icon": "$(add)"
      },
      {
        "command": "claudeAgents.initCoordination",
        "title": "Initialize Task Coordination",
        "category": "Claude Agents"
      },
      {
        "command": "claudeAgents.cleanupCompleted",
        "title": "Cleanup Completed Tasks",
        "category": "Claude Agents",
        "icon": "$(trash)"
      },
      {
        "command": "claudeAgents.refreshBacklog",
        "title": "Refresh Backlog",
        "category": "Claude Agents",
        "icon": "$(refresh)"
      },
      {
        "command": "claudeAgents.checkIsolation",
        "title": "Check Isolation Tiers",
        "category": "Claude Agents",
        "icon": "$(shield)"
      },
      {
        "command": "claudeAgents.runSetup",
        "title": "Run Setup Script",
        "category": "Claude Agents",
        "icon": "$(tools)"
      }
    ],
    "viewsContainers": {
      "activitybar": [
        {
          "id": "opus-orchestra",
          "title": "Claude Agents",
          "icon": "$(hubot)"
        }
      ]
    },
    "views": {
      "opus-orchestra": [
        {
          "id": "agentList",
          "name": "Agents"
        },
        {
          "id": "backlogList",
          "name": "Backlog"
        },
        {
          "id": "approvalQueue",
          "name": "Pending Approvals"
        }
      ]
    },
    "viewsWelcome": [
      {
        "view": "agentList",
        "contents": "No workspace folder open.\n[Open Folder](command:vscode.openFolder)",
        "when": "workbenchState == empty"
      },
      {
        "view": "agentList",
        "contents": "This project is not a git repository.\n[Initialize Project](command:claudeAgents.initProject)\nClaude Agents uses git worktrees for parallel agent isolation.",
        "when": "workbenchState != empty && !gitOpenRepositoryCount"
      },
      {
        "view": "agentList",
        "contents": "No agents created yet.\n[Create Agent Worktrees](command:claudeAgents.createAgents)\n[Open Dashboard](command:claudeAgents.openDashboard)",
        "when": "workbenchState != empty && gitOpenRepositoryCount"
      }
    ],
    "menus": {
      "view/title": [
        {
          "command": "claudeAgents.openDashboard",
          "when": "view == agentList",
          "group": "navigation"
        },
        {
          "command": "claudeAgents.refreshAgents",
          "when": "view == agentList",
          "group": "navigation"
        },
        {
          "command": "claudeAgents.openSettings",
          "when": "view == agentList",
          "group": "navigation"
        },
        {
          "command": "claudeAgents.createAgentForTask",
          "when": "view == agentList",
          "group": "1_create"
        },
        {
          "command": "claudeAgents.createAgents",
          "when": "view == agentList",
          "group": "1_create"
        },
        {
          "command": "claudeAgents.initCoordination",
          "when": "view == agentList",
          "group": "2_setup"
        },
        {
          "command": "claudeAgents.cleanupCompleted",
          "when": "view == agentList",
          "group": "3_cleanup"
        },
        {
          "command": "claudeAgents.refreshBacklog",
          "when": "view == backlogList",
          "group": "navigation"
        }
      ],
      "view/item/context": [
        {
          "command": "claudeAgents.startAgent",
          "when": "view == agentList && viewItem == agent",
          "group": "inline"
        },
        {
          "command": "claudeAgents.approveAction",
          "when": "view == approvalQueue",
          "group": "inline"
        },
        {
          "command": "claudeAgents.rejectAction",
          "when": "view == approvalQueue",
          "group": "inline"
        }
      ]
    },
    "keybindings": [
      {
        "command": "claudeAgents.switchToAgent",
        "key": "ctrl+shift+a",
        "mac": "cmd+shift+a"
      },
      {
        "command": "claudeAgents.showApprovals",
        "key": "ctrl+shift+q",
        "mac": "cmd+shift+q"
      },
      {
        "command": "claudeAgents.openDashboard",
        "key": "ctrl+shift+d",
        "mac": "cmd+shift+d"
      }
    ],
    "configuration": {
      "title": "Claude Agents",
      "properties": {
        "claudeAgents.repositoryPaths": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [],
          "description": "Git repository paths for agents. Leave empty to use current workspace."
        },
        "claudeAgents.defaultAgentCount": {
          "type": "number",
          "default": 3,
          "description": "Default number of agents to create"
        },
        "claudeAgents.worktreeDirectory": {
          "type": "string",
          "default": ".worktrees",
          "description": "Directory for agent worktrees"
        },
        "claudeAgents.claudeCommand": {
          "type": "string",
          "default": "claude",
          "description": "Command to start Claude Code"
        },
        "claudeAgents.autoStartClaude": {
          "type": "boolean",
          "default": false,
          "description": "Automatically start Claude when creating agent terminal"
        },
        "claudeAgents.autoStartClaudeOnFocus": {
          "type": "boolean",
          "default": true,
          "description": "Automatically start or resume Claude when opening/focusing an agent terminal"
        },
        "claudeAgents.logLevel": {
          "type": "string",
          "enum": [
            "debug",
            "info",
            "warn",
            "error"
          ],
          "default": "debug",
          "enumDescriptions": [
            "Debug - All messages including detailed diagnostics",
            "Info - General information and above",
            "Warn - Warnings and errors only",
            "Error - Errors only"
          ],
          "description": "Minimum log level for debug.log file output"
        },
        "claudeAgents.useTmux": {
          "type": "boolean",
          "default": true,
          "description": "Use tmux for terminal session persistence. Allows reconnecting to running Claude sessions after terminal closes."
        },
        "claudeAgents.tmuxSessionPrefix": {
          "type": "string",
          "default": "opus",
          "description": "Prefix for tmux session names (e.g., opus-{session-id})"
        },
        "claudeAgents.diffPollingInterval": {
          "type": "number",
          "default": 60000,
          "description": "Milliseconds between git diff stats refresh (default: 60 seconds). Set to 0 to disable."
        },
        "claudeAgents.coordinationScriptsPath": {
          "type": "string",
          "default": "",
          "description": "Path to the coordination scripts directory (containing init-agents.sh). Leave empty to use bundled scripts."
        },
        "claudeAgents.backlogPath": {
          "type": "string",
          "default": "",
          "description": "Path to the backlog directory. Will be symlinked into .opus-orchestra/backlog when initializing coordination."
        },
        "claudeAgents.terminalType": {
          "type": "string",
          "enum": [
            "bash",
            "wsl",
            "powershell",
            "cmd",
            "gitbash"
          ],
          "default": "bash",
          "enumDescriptions": [
            "Bash (macOS/Linux) - Native shell, uses Unix paths",
            "WSL (Windows Subsystem for Linux) - Uses /mnt/c/... paths",
            "PowerShell - Uses Windows paths with backslashes",
            "Command Prompt (CMD) - Uses Windows paths with backslashes",
            "Git Bash - Uses /c/... paths"
          ],
          "description": "Terminal type to use for running commands. This affects path conversion and how commands are executed."
        },
        "claudeAgents.showAllPermissionOptions": {
          "type": "boolean",
          "default": false,
          "description": "Show all 4 permission options (Allow, Always, Reject, Never) instead of just Allow/Reject"
        },
        "claudeAgents.uiScale": {
          "type": "number",
          "default": 1,
          "minimum": 0.75,
          "maximum": 1.5,
          "description": "UI scale factor for the dashboard (0.75 to 1.5)"
        },
        "claudeAgents.isolationTier": {
          "type": "string",
          "enum": [
            "standard",
            "sandbox",
            "docker",
            "gvisor",
            "cloud-hypervisor"
          ],
          "default": "standard",
          "enumDescriptions": [
            "Standard - Manual approval for all operations, no isolation",
            "Sandbox Runtime - Lightweight OS-level isolation using bubblewrap/sandbox-exec",
            "Docker Container - Container isolation with hardened security options",
            "gVisor - Kernel-level isolation via userspace syscall interception",
            "Cloud Hypervisor VM - Full VM isolation with virtio-fs mounts"
          ],
          "description": "Default isolation tier for new agents. Higher tiers provide more isolation and allow more autonomous operation."
        },
        "claudeAgents.containerImage": {
          "type": "string",
          "default": "ghcr.io/kyleherndon/opus-orchestra-sandbox:latest",
          "description": "Docker image for containerized agents"
        },
        "claudeAgents.containerMemoryLimit": {
          "type": "string",
          "default": "4g",
          "description": "Memory limit for containers/VMs (e.g., 2g, 4g, 8g)"
        },
        "claudeAgents.containerCpuLimit": {
          "type": "string",
          "default": "2",
          "description": "CPU limit for containers/VMs"
        },
        "claudeAgents.containerPidsLimit": {
          "type": "number",
          "default": 100,
          "description": "Maximum number of processes in container (prevents fork bombs)"
        },
        "claudeAgents.gvisorEnabled": {
          "type": "boolean",
          "default": false,
          "description": "Use gVisor runtime (runsc) for Docker containers"
        },
        "claudeAgents.cloudHypervisorPath": {
          "type": "string",
          "default": "",
          "description": "Path to Cloud Hypervisor binary. Leave empty to use default from PATH."
        },
        "claudeAgents.allowedDomains": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [
            "api.anthropic.com",
            "registry.npmjs.org",
            "pypi.org"
          ],
          "description": "Domains that isolated agents can access through the proxy"
        },
        "claudeAgents.proxyPort": {
          "type": "number",
          "default": 8377,
          "description": "Port for the isolation proxy service"
        },
        "claudeAgents.autoSwitchToApiOnRateLimit": {
          "type": "boolean",
          "default": false,
          "description": "Automatically switch to API key when subscription is rate-limited"
        }
      }
    }
  },
  "scripts": {
    "vscode:prepublish": "npm run package",
    "package": "npm run check-types && node src/agentPanel/build.js && node esbuild.js --production",
    "compile": "tsc -p ./ && node src/agentPanel/build.js",
    "build": "npm run compile",
    "check-types": "tsc --noEmit",
    "watch": "tsc -watch -p ./",
    "watch:webview": "node src/agentPanel/build.js --watch",
    "lint": "eslint src --ext ts --max-warnings 0",
    "test": "npm run compile && node ./out/test/runTest.js",
    "test:unit": "npm run compile && mocha --ui tdd ./out/test/suite/agentPanel.test.js ./out/test/suite/statusWatcher.test.js",
    "test:ui": "./scripts/test-ui.sh run",
    "test:ui:setup": "./scripts/test-ui.sh setup",
    "test:ui:run": "./scripts/test-ui.sh run",
    "test:ui:check": "./scripts/test-ui.sh check",
    "test:ui:windows": "extest setup-and-run ./out/test/ui/*.test.js --mocha_config .mocharc.json --storage .vscode-test",
    "test:ui:windows:setup": "extest get-vscode --storage .vscode-test && extest get-chromedriver --storage .vscode-test",
    "test:ui:windows:run": "extest run-tests ./out/test/ui/*.test.js --mocha_config .mocharc.json --storage .vscode-test",
    "clean": "rm -rf out"
  },
  "dependencies": {
    "@opus-orchestra/core": "*"
  },
  "devDependencies": {
    "@types/chai": "^5.2.3",
    "@types/mocha": "^10.0.10",
    "@types/node": "^18.x",
    "@types/vscode": "^1.85.0",
    "@typescript-eslint/eslint-plugin": "^6.x",
    "@typescript-eslint/parser": "^6.x",
    "@vscode/test-electron": "^2.5.2",
    "chai": "^6.2.1",
    "esbuild": "^0.27.2",
    "esbuild-svelte": "^0.9.4",
    "eslint": "^8.x",
    "mocha": "^11.7.5",
    "svelte": "^5.46.0",
    "typescript": "^5.x",
    "vscode-extension-tester": "^8.19.0"
  }
}
